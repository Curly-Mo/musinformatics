{% extends "base.html" %}

{% block style_block %}
    <style type="text/css">
        table.table { width: 60%; }
    </style>
{% endblock %}

{% block content %}

<div class="ui container">
    <h1 class="ui header">Instrument Classification</h1>
    <form id="instrument_form" class="ui form raised padded segment inverted"
        action="{{ url_for('instrument') }}" method="post" enctype="multipart/form-data">
        {{ form.hidden_tag() }}
        {% for field in form if field.type != 'CSRFTokenField' %}
            <div class="field">
            {% if field.type == 'FileField' %}
               {{ field.label }}
               {{ field|safe }}
            {% else %}
                {{ field.label }}
                {{ field|safe }}
            {% endif %}
            </div>
        {% endfor %}
        <button class="ui primary submit button" type="submit">Identify</button>
        <div class="ui error message inverted"></div>
    </form>
</div>


{% endblock content %}


{% block footer %}
{% endblock footer %}


{% block tail_script %}
<script>
$('.ui.form').form({
    fields: {
      file: {
        identifier : 'file',
        rules: [
          {
            type   : 'empty',
            prompt : 'Please upload a file'
          },
          {
            type   : 'regExp[/.*\.(wav|mp3)/]',
            prompt : 'Allowed extensions: [.wav, .mp3]'
          }
        ]
      }
    }
});

$('form').on('submit', function(e) {
    $.ajax({
        url: '{{ url_for('instrument') }}',
        data: new FormData($('form')[0]),
        type: 'POST',
        contentType: false,
        processData: false,
        success: function(response) {
            console.log(response.instrument);
        },
        error: function(error) {
            console.log(error);
        }
    });
return false;
});
</script>
{% endblock tail_script %}
